{
  "apiVersion": "automation.colonies.io/v1",
  "kind": "Workflow",
  "metadata": {
    "name": "daily-data-pipeline",
    "namespace": "analytics-colony",
    "labels": {
      "type": "data-pipeline",
      "schedule": "daily"
    },
    "annotations": {
      "description": "Daily data ingestion and processing pipeline",
      "owner": "data-engineering@example.com"
    }
  },
  "spec": {
    "schedule": "0 1 * * *",
    "steps": [
      {
        "name": "ingest-raw-data",
        "type": "function",
        "functionSpec": {
          "funcName": "s3_ingest",
          "conditions": {
            "executorType": "data-ingestion"
          },
          "kwargs": {
            "bucket": "raw-data",
            "prefix": "daily/",
            "format": "parquet"
          }
        }
      },
      {
        "name": "validate-data",
        "type": "function",
        "dependsOn": ["ingest-raw-data"],
        "functionSpec": {
          "funcName": "validate_schema",
          "conditions": {
            "executorType": "data-validation"
          }
        }
      },
      {
        "name": "transform-data",
        "type": "function",
        "dependsOn": ["validate-data"],
        "functionSpec": {
          "funcName": "spark_transform",
          "conditions": {
            "executorType": "spark-executor",
            "nodes": 10
          },
          "kwargs": {
            "transformations": [
              "clean_nulls",
              "aggregate_metrics",
              "join_dimensions"
            ]
          }
        }
      },
      {
        "name": "load-to-warehouse",
        "type": "function",
        "dependsOn": ["transform-data"],
        "functionSpec": {
          "funcName": "warehouse_load",
          "conditions": {
            "executorType": "data-warehouse"
          },
          "kwargs": {
            "table": "analytics.daily_metrics",
            "mode": "overwrite"
          }
        }
      },
      {
        "name": "update-dashboard",
        "type": "function",
        "dependsOn": ["load-to-warehouse"],
        "functionSpec": {
          "funcName": "refresh_dashboard",
          "conditions": {
            "executorType": "analytics-service"
          },
          "kwargs": {
            "dashboardId": "daily-metrics"
          }
        }
      }
    ],
    "onFailure": {
      "notify": ["data-team-slack"],
      "retry": {
        "maxAttempts": 3,
        "backoff": "exponential"
      }
    }
  },
  "status": {
    "phase": "Succeeded",
    "lastRun": "2025-10-20T01:00:00Z",
    "nextRun": "2025-10-21T01:00:00Z",
    "completedSteps": 5,
    "totalSteps": 5,
    "duration": "1h23m45s",
    "history": [
      {
        "runId": "run-2025-10-20",
        "startTime": "2025-10-20T01:00:00Z",
        "endTime": "2025-10-20T02:23:45Z",
        "status": "Succeeded"
      },
      {
        "runId": "run-2025-10-19",
        "startTime": "2025-10-19T01:00:00Z",
        "endTime": "2025-10-19T02:18:32Z",
        "status": "Succeeded"
      }
    ]
  }
}
